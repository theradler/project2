<!DOCTYPE html>
<html lang="en">
<script src="../functions.js" type="text/javascript"></script>
<script>

    document.addEventListener('DOMContentLoaded', init)


  function init() {
    var channel = ['General','Random','Status']
    localStorage.setItem("channel_list", JSON.stringify(channel));
    loadUsername()
    loadChannels()
  }

  function loadChannels() {
    var channel = JSON.parse(localStorage.getItem("channel_list"));
    var text = "";
    var i;
    for (i = 0; i < channel.length; i++) {
      text += channel[i] + "<br>";
    }
    document.getElementById("channelList").innerHTML = text;
  }

function addChannel() {
   var newChannel = document.getElementById("channel_input_field").value
   var channel = JSON.parse(localStorage.getItem("channel_list"));
   channel.push(document.getElementById("channel_input_field").value)
   localStorage.setItem("channel_list", JSON.stringify(channel))
   loadChannels()

  }

  
  function loadUsername() {
    if (localStorage.getItem("username") != null) {
      document.getElementById("localMem").innerHTML = localStorage.getItem("username")
    }
  }

  function saveUserName() {
    localStorage.setItem("username", document.getElementById("username_field").value)
    document.getElementById("localMem").innerHTML = localStorage.getItem("username")

    }

    function ajaxRequest() {
        var xHttpRequest = new XMLHttpRequest();
        xHttpRequest.onreadystatechange = () => {
            if (xHttpRequest.readyState == XMLHttpRequest.DONE && xHttpRequest.status == 200) {
                document.getElementById('ajaxReturnArea').innerHTML = "Hey this is ajax bitch"
            }
        };
        xHttpRequest.open('GET', '/', true);
        xHttpRequest.send();

        
    }

    function messageJsonBuilder(channel, user, message) {
        var messageObject = {};
        messageObject.channel = channel;
        messageObject.user = user;
        messageObject.timestamp = Date.getTime();
        return messageObject;
                
    }

    function messageSender() {
        var 
    }


    function getMessages() {
        var channel = "General"
        var messages = null 
        var messageXChannel = JSON.parse(localStorage.getItem("messageXChannel"))
        messages = messageXChannel.filter(messageXChannel => { return messageXChannel.channel.name == channel})
        messages = messageXChannel[0].messages 
        for (message in  messages) {
            renderMessages(messages[message]);
        }

    }


    function addMessage() {
        var channel = "General";
        var inputMessage = "New Message"
        var messageXChannel = JSON.parse(localStorage.getItem("messageXChannel"));
        var channelMessages = messageXChannel.filter((messageXChannel) => { return messageXChannel.channel == channel });
        localStorage.setItem("temp", JSON.stringify(channelMessages));
    }

    function renderMessages(message) {
        const post = document.createElement('div');
        post.className = 'message';
        post.innerHTML = message

        document.querySelector('#messages').append(post); 
    }




</script>


<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>

<body>
    {{ channel_list }}
    <form>
        Username: <br>
        <input type="text" id="username_field">
    </form>
    <button onclick="saveUserName()">Submit Username</button>
    <div>
        <h1>Username: </h1>
        <h2 id="localMem"></h2>


        <form id="new_channel_form">
            Channel: <br>
            <input type="text" id="channel_input_field">
        </form>
        <button onclick="addChannel()">Add Channel</button>


        <h1>Channels: </h1>
        <p id="channelList"></p>

        </h1>
    </div>
    <div id="demo">
        <button type="button" onclick="makeChannelWithMessage()">Make Ajax Request</button>
        <button type="button" onclick="getMessages()">Get Messages</button>
        <button type="button" onclick="addMessage()">Add Messages</button>
    </div>
    <div id="ajaxReturnArea">

    </div>

   <div id="messages">

   </div>
</body>

</html>
